#!/bin/bash

touch /etc/dd-agent/conf.d/mysql.yaml.default

echo "init_config:

instances:

  - server: localhost
	user: datadog
	pass: JSyOG3K03cvnpPyUOdUHRcoj
" >> /etc/dd-agent/conf.d/mysql.yaml.default

mysql -e "CREATE USER 'datadog'@'localhost' IDENTIFIED BY 'JSyOG3K03cvnpPyUOdUHRcoj';"
mysql -e "GRANT REPLICATION CLIENT ON *.* TO 'datadog'@'localhost' WITH MAX_USER_CONNECTIONS 5;"
mysql -e "GRANT PROCESS ON *.* TO 'datadog'@'localhost';"
mysql -e "GRANT SELECT ON performance_schema.* TO 'datadog'@'localhost';"

/etc/init.d/datadog-agent restart

sleep 5

/etc/init.d/datadog-agent info -A